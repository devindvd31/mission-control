<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control - ä»»å‹™ä¸­æ§å°</title>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --bg-primary: #0f0f23;
      --bg-secondary: #1a1a2e;
      --bg-card: #16213e;
      --accent: #0f3460;
      --highlight: #e94560;
      --text-primary: #eaeaea;
      --text-secondary: #a0a0a0;
      --success: #00d9a5;
      --warning: #ffc107;
      --danger: #ff4757;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
    }
    
    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      padding: 20px;
      display: flex;
      flex-direction: column;
      border-right: 1px solid var(--accent);
    }
    
    .logo {
      font-size: 24px;
      font-weight: bold;
      color: var(--highlight);
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--highlight);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .nav-item {
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 8px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .nav-item:hover {
      background: var(--accent);
    }
    
    .nav-item.active {
      background: var(--highlight);
      color: white;
    }
    
    .nav-icon {
      font-size: 18px;
    }
    
    /* Main Content */
    .main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .header h1 {
      font-size: 28px;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
    }
    
    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .btn-primary {
      background: var(--highlight);
      color: white;
    }
    
    .btn-primary:hover {
      background: #d63d56;
    }
    
    .btn-secondary {
      background: var(--accent);
      color: var(--text-primary);
    }
    
    /* Stats Cards */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: var(--bg-card);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--accent);
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
    }
    
    .stat-card.success .stat-value { color: var(--success); }
    .stat-card.warning .stat-value { color: var(--warning); }
    .stat-card.danger .stat-value { color: var(--danger); }
    
    /* Calendar */
    .calendar-container {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--accent);
    }
    
    #calendar {
      background: var(--bg-card);
    }
    
    .fc {
      --fc-border-color: var(--accent);
      --fc-button-bg-color: var(--accent);
      --fc-button-border-color: var(--accent);
      --fc-button-hover-bg-color: var(--highlight);
      --fc-button-hover-border-color: var(--highlight);
      --fc-today-bg-color: rgba(233, 69, 96, 0.1);
      --fc-event-bg-color: var(--highlight);
      --fc-event-border-color: var(--highlight);
    }
    
    .fc .fc-daygrid-day-number,
    .fc .fc-col-header-cell-cushion {
      color: var(--text-primary);
    }
    
    .fc-theme-standard td, .fc-theme-standard th {
      border-color: var(--accent);
    }
    
    /* Task List */
    .task-list {
      display: none;
    }
    
    .task-list.active {
      display: block;
    }
    
    .task-item {
      background: var(--bg-card);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      border: 1px solid var(--accent);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .task-priority {
      width: 4px;
      height: 40px;
      border-radius: 2px;
    }
    
    .task-priority.high { background: var(--danger); }
    .task-priority.medium { background: var(--warning); }
    .task-priority.low { background: var(--success); }
    
    .task-content {
      flex: 1;
    }
    
    .task-title {
      font-weight: 500;
      margin-bottom: 4px;
    }
    
    .task-meta {
      font-size: 12px;
      color: var(--text-secondary);
    }
    
    .task-status {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
    }
    
    .task-status.pending { background: rgba(255, 193, 7, 0.2); color: var(--warning); }
    .task-status.in-progress { background: rgba(233, 69, 96, 0.2); color: var(--highlight); }
    .task-status.completed { background: rgba(0, 217, 165, 0.2); color: var(--success); }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: var(--bg-secondary);
      padding: 30px;
      border-radius: 12px;
      width: 500px;
      max-width: 90%;
    }
    
    .modal h2 {
      margin-bottom: 20px;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid var(--accent);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 14px;
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .modal-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <div class="logo-icon">ğŸš€</div>
      Mission Control
    </div>
    
    <div class="nav-item active" data-view="calendar">
      <span class="nav-icon">ğŸ“…</span>
      Calendar View
    </div>
    <div class="nav-item" data-view="tasks">
      <span class="nav-icon">ğŸ“‹</span>
      All Tasks
    </div>
    <div class="nav-item" data-view="settings">
      <span class="nav-icon">âš™ï¸</span>
      Settings
    </div>
  </div>
  
  <!-- Main Content -->
  <div class="main">
    <div class="header">
      <h1>ä»»å‹™ç¸½è¦½</h1>
      <div class="header-actions">
        <button class="btn btn-secondary" onclick="syncTasks()">ğŸ”„ Sync</button>
        <button class="btn btn-primary" onclick="openModal()">+ New Task</button>
      </div>
    </div>
    
    <!-- Stats -->
    <div class="stats">
      <div class="stat-card">
        <div class="stat-value" id="totalTasks">0</div>
        <div class="stat-label">ç¸½ä»»å‹™æ•¸</div>
      </div>
      <div class="stat-card warning">
        <div class="stat-value" id="pendingTasks">0</div>
        <div class="stat-label">å¾…è™•ç†</div>
      </div>
      <div class="stat-card danger">
        <div class="stat-value" id="inProgressTasks">0</div>
        <div class="stat-label">é€²è¡Œä¸­</div>
      </div>
      <div class="stat-card success">
        <div class="stat-value" id="completedTasks">0</div>
        <div class="stat-label">å·²å®Œæˆ</div>
      </div>
    </div>
    
    <!-- Calendar View -->
    <div class="calendar-container" id="calendarView">
      <div id="calendar"></div>
    </div>
    
    <!-- Task List View -->
    <div class="task-list" id="taskListView">
      <div id="taskList"></div>
    </div>
  </div>
  
  <!-- New Task Modal -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <h2>å»ºç«‹æ–°ä»»å‹™</h2>
      <form id="taskForm">
        <div class="form-group">
          <label>ä»»å‹™æ¨™é¡Œ</label>
          <input type="text" id="taskTitle" required placeholder="è¼¸å…¥ä»»å‹™æ¨™é¡Œ">
        </div>
        <div class="form-group">
          <label>æè¿°</label>
          <textarea id="taskDesc" placeholder="è¼¸å…¥ä»»å‹™æè¿°"></textarea>
        </div>
        <div class="form-group">
          <label>å„ªå…ˆç´š</label>
          <select id="taskPriority">
            <option value="low">Low - ä½</option>
            <option value="medium" selected>Medium - ä¸­</option>
            <option value="high">High - é«˜</option>
          </select>
        </div>
        <div class="form-group">
          <label>æˆªæ­¢æ—¥æœŸ</label>
          <input type="date" id="taskDueDate">
        </div>
        <div class="form-group">
          <label>ç‹€æ…‹</label>
          <select id="taskStatus">
            <option value="pending">Pending - å¾…è™•ç†</option>
            <option value="in-progress">In Progress - é€²è¡Œä¸­</option>
            <option value="completed">Completed - å·²å®Œæˆ</option>
          </select>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
          <button type="submit" class="btn btn-primary">å»ºç«‹ä»»å‹™</button>
        </div>
      </form>
    </div>
  </div>
  
  <script>
    // State
    let tasks = [];
    let calendar;
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      initCalendar();
      loadTasks();
      setupNavigation();
    });
    
    // Initialize FullCalendar
    function initCalendar() {
      const calendarEl = document.getElementById('calendar');
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,listWeek'
        },
        events: function(info, successCallback, failureCallback) {
          const events = tasks.map(task => ({
            id: task.id,
            title: task.title,
            start: task.dueDate,
            backgroundColor: getPriorityColor(task.priority),
            borderColor: getPriorityColor(task.priority)
          }));
          successCallback(events);
        },
        eventClick: function(info) {
          const task = tasks.find(t => t.id == info.event.id);
          if (task) {
            alert(`ä»»å‹™: ${task.title}\nå„ªå…ˆç´š: ${task.priority}\nç‹€æ…‹: ${task.status}\næè¿°: ${task.description || 'ç„¡'}`);
          }
        }
      });
      calendar.render();
    }
    
    // Load Tasks - fetch from GitHub JSON first, fallback to localStorage
    async function loadTasks() {
      try {
        const response = await fetch('data/tasks.json?v=' + new Date().getTime());
        if (response.ok) {
          tasks = await response.json();
          // Also save to localStorage as backup
          localStorage.setItem('tasks', JSON.stringify(tasks));
        }
      } catch (e) {
        console.log('Cannot load from server, using localStorage');
        const stored = localStorage.getItem('tasks');
        if (stored) {
          tasks = JSON.parse(stored);
        }
      }
      updateStats();
      renderTaskList();
      if (calendar) {
        calendar.refetchEvents();
      }
    }
    
    // Save Tasks
    async function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
      updateStats();
      renderTaskList();
      if (calendar) {
        calendar.refetchEvents();
      }
      
      // Try to save to file (will fail in browser, but that's ok)
      try {
        await fetch('data/tasks.json', {
          method: 'PUT',
          body: JSON.stringify(tasks, null, 2)
        });
      } catch (e) {
        console.log('Cannot save to server in browser mode');
      }
    }
    
    // Update Stats
    function updateStats() {
      document.getElementById('totalTasks').textContent = tasks.length;
      document.getElementById('pendingTasks').textContent = tasks.filter(t => t.status === 'pending').length;
      document.getElementById('inProgressTasks').textContent = tasks.filter(t => t.status === 'in-progress').length;
      document.getElementById('completedTasks').textContent = tasks.filter(t => t.status === 'completed').length;
    }
    
    // Render Task List
    function renderTaskList() {
      const container = document.getElementById('taskList');
      container.innerHTML = tasks.map(task => `
        <div class="task-item">
          <div class="task-priority ${task.priority}"></div>
          <div class="task-content">
            <div class="task-title">${task.title}</div>
            <div class="task-meta">${task.dueDate || 'ç„¡æˆªæ­¢æ—¥'} â€¢ ${task.priority}</div>
          </div>
          <span class="task-status ${task.status}">${getStatusText(task.status)}</span>
        </div>
      `).join('');
    }
    
    // Get Status Text
    function getStatusText(status) {
      const map = {
        'pending': 'å¾…è™•ç†',
        'in-progress': 'é€²è¡Œä¸­',
        'completed': 'å·²å®Œæˆ'
      };
      return map[status] || status;
    }
    
    // Get Priority Color
    function getPriorityColor(priority) {
      const colors = {
        'high': '#ff4757',
        'medium': '#ffc107',
        'low': '#00d9a5'
      };
      return colors[priority] || '#e94560';
    }
    
    // Setup Navigation
    function setupNavigation() {
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function() {
          const view = this.dataset.view;
          
          // Update active state
          document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
          this.classList.add('active');
          
          // Show/hide views
          document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
          document.getElementById('taskListView').classList.toggle('active', view === 'tasks');
        });
      });
    }
    
    // Modal Functions
    function openModal() {
      document.getElementById('taskModal').classList.add('active');
    }
    
    function closeModal() {
      document.getElementById('taskModal').classList.remove('active');
      document.getElementById('taskForm').reset();
    }
    
    // Form Submit
    document.getElementById('taskForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const newTask = {
        id: Date.now(),
        title: document.getElementById('taskTitle').value,
        description: document.getElementById('taskDesc').value,
        priority: document.getElementById('taskPriority').value,
        dueDate: document.getElementById('taskDueDate').value,
        status: document.getElementById('taskStatus').value,
        createdAt: new Date().toISOString()
      };
      
      tasks.push(newTask);
      saveTasks();
      closeModal();
    });
    
    // Sync (placeholder)
    function syncTasks() {
      // Force reload tasks from GitHub
      localStorage.removeItem('tasks');
      loadTasks();
      alert('å·²åŒæ­¥æœ€æ–°ä»»å‹™ï¼');
    }
  </script>
</body>
</html>
